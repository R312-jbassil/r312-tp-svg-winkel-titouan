---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <div class="flex flex-col gap-6 p-6">
        <!-- Zone d'entrée du prompt -->
        <div class="card bg-base-200 shadow-xl p-4">
            <h2 class="text-xl font-bold mb-2">Enter your prompt</h2>
            <textarea
                id="user-prompt"
                placeholder="Describe the SVG you want..."
                class="textarea textarea-bordered w-full h-32 mb-4"></textarea>
            <button id="generate-button" class="btn btn-primary"
                >Generate</button
            >
        </div>

        <!-- Zone pour afficher le code généré -->
        <div class="card bg-base-200 shadow-xl p-4">
            <h2 class="text-xl font-bold mb-2">Generated Code</h2>
            <pre
                id="svg-output"
                class="bg-base-300 p-4 rounded-lg overflow-auto text-sm">
                <!-- Le code SVG généré apparaîtra ici -->
            </pre>
        </div>

        <!-- Zone pour afficher le SVG rendu -->
        <div class="card bg-base-200 shadow-xl p-4 flex flex-col items-center">
            <h2 class="text-xl font-bold mb-2">SVG Preview</h2>
            <div
                id="svg-container"
                class="bg-base-100 p-4 rounded-lg w-full h-64 flex items-center justify-center"
            >
                <!-- Le SVG rendu apparaîtra ici -->
            </div>
        </div>
    </div>
</Layout>

<script>
    //@ts-nocheck

    async function generateSVG(prompt) {
        console.log("Generating SVG for prompt:", prompt);
        const res = await fetch("/api/generateSVG", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
        });
        const data = await res.json();
        return data.svg;
    }

    async function handleSubmit() {
        let prompt = "";
        let svgCode = "";
        const promptElement = document.getElementById("user-prompt");
        prompt = promptElement ? promptElement.value : "";
        console.log("submitted: ", prompt); // message affiché sur votre console d'inspecteur dans le navigateur

        const svgContainer = document.getElementById("svg-container");
        let svgOutput = document.getElementById("svg-output");

        // Ajout du spinner et désactivation du bouton
        svgContainer.innerHTML = `<span class="loading loading-ring loading-xl"></span>`;
        generateButton.disabled = true;

        svgCode = await generateSVG(prompt);
        console.log("svgCode: ", svgCode);

        svgOutput.textContent = svgCode;
        svgContainer.innerHTML = svgCode;

        // Réactivation du bouton après la réponse
        generateButton.disabled = false;
    }
    const generateButton = document.getElementById("generate-button");
    if (generateButton) {
        generateButton.addEventListener("click", handleSubmit);
    }
</script>
